{"version":3,"file":"index.js","sources":["../../src/client/components/Toc.ts"],"sourcesContent":["import type { PropType, VNode } from 'vue'\nimport { computed, defineComponent, h, toRefs } from 'vue'\nimport type { RouteLocationNormalizedLoaded } from 'vue-router'\nimport { RouterLink } from 'vue-router'\nimport type { PageHeader } from 'vuepress/client'\nimport { RouteLink, usePageData, useRoute } from 'vuepress/client'\nimport type { TocPropsOptions } from '../../shared/index.js'\n\nexport type TocPropsHeaders = PageHeader[]\n\nexport interface TocProps {\n  headers: TocPropsHeaders\n  options: TocPropsOptions\n}\n\nconst renderLink = (\n  header: PageHeader,\n  options: TocPropsOptions,\n  route: RouteLocationNormalizedLoaded,\n): VNode => {\n  const hash = `#${header.slug}`\n  const linkClass = [options.linkClass]\n\n  // add active class if the header hash is matched\n  if (options.linkActiveClass && route.hash === hash) {\n    linkClass.push(options.linkActiveClass)\n  }\n\n  // add active class if any sub-header hash is matched\n  if (\n    options.linkChildrenActiveClass &&\n    header.children.some((item) => `#${item.slug}` === route.hash)\n  ) {\n    linkClass.push(options.linkChildrenActiveClass)\n  }\n\n  if (options.linkTag === 'RouteLink') {\n    return h(\n      RouteLink,\n      {\n        to: hash,\n        class: linkClass,\n        ariaLabel: header.title,\n      },\n      () => header.title,\n    )\n  }\n\n  if (options.linkTag === 'RouterLink') {\n    return h(\n      RouterLink,\n      {\n        to: hash,\n        class: linkClass,\n        ariaLabel: header.title,\n      },\n      () => header.title,\n    )\n  }\n\n  return h(\n    'a',\n    {\n      href: hash,\n      class: linkClass,\n      ariaLabel: header.title,\n    },\n    header.title,\n  )\n}\n\nconst renderHeaders = (\n  headers: PageHeader[],\n  options: TocPropsOptions,\n  route: RouteLocationNormalizedLoaded,\n): VNode[] => {\n  if (headers.length === 0) {\n    return []\n  }\n\n  return [\n    h(\n      'ul',\n      {\n        class: options.listClass,\n      },\n      headers.map((header) =>\n        h(\n          'li',\n          {\n            class: options.itemClass,\n          },\n          [\n            renderLink(header, options, route),\n            renderHeaders(header.children, options, route),\n          ],\n        ),\n      ),\n    ),\n  ]\n}\n\nexport const Toc = defineComponent({\n  name: 'Toc',\n\n  props: {\n    headers: {\n      type: Array as PropType<TocPropsHeaders | undefined>,\n      default: undefined,\n    },\n\n    options: {\n      type: Object as PropType<Partial<TocPropsOptions>>,\n      default: () => ({}),\n    },\n  },\n\n  setup(props) {\n    const { headers: propsHeaders, options: propsOptions } = toRefs(props)\n\n    const route = useRoute()\n    const page = usePageData()\n    const headers = computed<TocPropsHeaders>(() => {\n      const headersToUse = propsHeaders.value ?? page.value.headers\n\n      // skip h1 header\n      return headersToUse[0]?.level === 1\n        ? headersToUse[0].children\n        : headersToUse\n    })\n    const options = computed<TocPropsOptions>(() => ({\n      containerTag: 'nav',\n      containerClass: 'vuepress-toc',\n      listClass: 'vuepress-toc-list',\n      itemClass: 'vuepress-toc-item',\n      linkTag: 'RouteLink',\n      linkClass: 'vuepress-toc-link',\n      linkActiveClass: 'active',\n      linkChildrenActiveClass: 'active',\n      ...propsOptions.value,\n    }))\n\n    return () => {\n      const renderedHeaders = renderHeaders(headers.value, options.value, route)\n\n      if (options.value.containerTag) {\n        return h(\n          options.value.containerTag,\n          {\n            class: options.value.containerClass,\n          },\n          renderedHeaders,\n        )\n      }\n\n      return renderedHeaders\n    }\n  },\n})\n"],"names":["renderLink","header","options","route","hash","linkClass","item","h","RouteLink","RouterLink","renderHeaders","headers","Toc","defineComponent","props","propsHeaders","propsOptions","toRefs","useRoute","page","usePageData","computed","headersToUse","renderedHeaders"],"mappings":"0LAeA,MAAMA,EAAa,CACjBC,EACAC,EACAC,IACU,CACV,MAAMC,EAAO,IAAIH,EAAO,IAAI,GACtBI,EAAY,CAACH,EAAQ,SAAS,EAepC,OAZIA,EAAQ,iBAAmBC,EAAM,OAASC,GAC5CC,EAAU,KAAKH,EAAQ,eAAe,EAKtCA,EAAQ,yBACRD,EAAO,SAAS,KAAMK,GAAS,IAAIA,EAAK,IAAI,KAAOH,EAAM,IAAI,GAE7DE,EAAU,KAAKH,EAAQ,uBAAuB,EAG5CA,EAAQ,UAAY,YACfK,EACLC,EACA,CACE,GAAIJ,EACJ,MAAOC,EACP,UAAWJ,EAAO,KACpB,EACA,IAAMA,EAAO,KACf,EAGEC,EAAQ,UAAY,aACfK,EACLE,EACA,CACE,GAAIL,EACJ,MAAOC,EACP,UAAWJ,EAAO,KACpB,EACA,IAAMA,EAAO,KACf,EAGKM,EACL,IACA,CACE,KAAMH,EACN,MAAOC,EACP,UAAWJ,EAAO,KACpB,EACAA,EAAO,KACT,CACF,EAEMS,EAAgB,CACpBC,EACAT,EACAC,IAEIQ,EAAQ,SAAW,EACd,CAAA,EAGF,CACLJ,EACE,KACA,CACE,MAAOL,EAAQ,SACjB,EACAS,EAAQ,IAAKV,GACXM,EACE,KACA,CACE,MAAOL,EAAQ,SACjB,EACA,CACEF,EAAWC,EAAQC,EAASC,CAAK,EACjCO,EAAcT,EAAO,SAAUC,EAASC,CAAK,CAC/C,CACF,CACF,CACF,CACF,EAGWS,EAAMC,EAAgB,CACjC,KAAM,MAEN,MAAO,CACL,QAAS,CACP,KAAM,MACN,QAAS,MACX,EAEA,QAAS,CACP,KAAM,OACN,QAAS,KAAO,GAClB,CACF,EAEA,MAAMC,EAAO,CACX,KAAM,CAAE,QAASC,EAAc,QAASC,CAAa,EAAIC,EAAOH,CAAK,EAE/DX,EAAQe,IACRC,EAAOC,EACPT,EAAAA,EAAUU,EAA0B,IAAM,CAC9C,MAAMC,EAAeP,EAAa,OAASI,EAAK,MAAM,QAGtD,OAAOG,EAAa,CAAC,GAAG,QAAU,EAC9BA,EAAa,CAAC,EAAE,SAChBA,CACN,CAAC,EACKpB,EAAUmB,EAA0B,KAAO,CAC/C,aAAc,MACd,eAAgB,eAChB,UAAW,oBACX,UAAW,oBACX,QAAS,YACT,UAAW,oBACX,gBAAiB,SACjB,wBAAyB,SACzB,GAAGL,EAAa,KAClB,EAAE,EAEF,MAAO,IAAM,CACX,MAAMO,EAAkBb,EAAcC,EAAQ,MAAOT,EAAQ,MAAOC,CAAK,EAEzE,OAAID,EAAQ,MAAM,aACTK,EACLL,EAAQ,MAAM,aACd,CACE,MAAOA,EAAQ,MAAM,cACvB,EACAqB,CACF,EAGKA,CACT,CACF,CACF,CAAC"}