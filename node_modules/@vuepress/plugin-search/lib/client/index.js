import{onMounted as T,onBeforeUnmount as U,ref as h,computed as g,defineComponent as F,toRefs as B,h as i}from"vue";import{useRouter as H,useRouteLocale as P}from"vuepress/client";import{isString as j}from"vuepress/shared";import{SEARCH_INDEX as V}from"@internal/searchIndex";const w=e=>e instanceof Element?document.activeElement===e&&(["TEXTAREA","SELECT","INPUT"].includes(e.tagName)||e.hasAttribute("contenteditable")):!1,I=(e,t)=>t.some(n=>{if(j(n))return n===e.key;const{key:a,ctrl:c=!1,shift:s=!1,alt:u=!1}=n;return a===e.key&&c===e.ctrlKey&&s===e.shiftKey&&u===e.altKey}),q=/[^\x00-\x7F]/,X=e=>e.split(/\s+/g).map(t=>t.trim()).filter(t=>!!t),_=e=>e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),k=(e,t)=>{const n=t.join(" "),a=X(e);if(q.test(e))return a.some(s=>n.toLowerCase().includes(s));const c=e.endsWith(" ");return new RegExp(`${a.map((s,u)=>a.length===u+1&&!c?`(?=.*\\b${_(s)})`:`(?=.*\\b${_(s)}\\b)`).join("")}.+`,"gi").test(n)},K=({input:e,hotKeys:t})=>{if(t.value.length===0)return;const n=a=>{e.value&&I(a,t.value)&&!w(a.target)&&(a.preventDefault(),e.value.focus())};T(()=>{document.addEventListener("keydown",n)}),U(()=>{document.removeEventListener("keydown",n)})},E=h(V),L=()=>E;__VUEPRESS_DEV__&&(import.meta.webpackHot||import.meta.hot)&&(__VUE_HMR_RUNTIME__.updateSearchIndex=e=>{E.value=e});const R=({searchIndex:e,routeLocale:t,query:n,maxSuggestions:a})=>{const c=g(()=>e.value.filter(s=>s.pathLocale===t.value));return g(()=>{const s=n.value.trim().toLowerCase();if(!s)return[];const u=[],f=(o,l)=>{k(s,[l.title])&&u.push({link:`${o.path}#${l.slug}`,title:o.title,header:l.title});for(const y of l.children){if(u.length>=a.value)return;f(o,y)}};for(const o of c.value){if(u.length>=a.value)break;if(k(s,[o.title,...o.extraFields])){u.push({link:o.path,title:o.title});continue}for(const l of o.headers){if(u.length>=a.value)break;f(o,l)}}return u})},$=e=>{const t=h(0);return{focusIndex:t,focusNext:()=>{t.value<e.value.length-1?t.value+=1:t.value=0},focusPrev:()=>{t.value>0?t.value-=1:t.value=e.value.length-1}}},O=F({name:"SearchBox",props:{locales:{type:Object,default:()=>({})},hotKeys:{type:Array,default:()=>[]},maxSuggestions:{type:Number,default:5}},setup(e){const{locales:t,hotKeys:n,maxSuggestions:a}=B(e),c=H(),s=P(),u=L(),f=h(null),o=h(!1),l=h(""),y=g(()=>t.value[s.value]??{}),p=R({searchIndex:u,routeLocale:s,query:l,maxSuggestions:a}),{focusIndex:v,focusNext:A,focusPrev:M}=$(p);K({input:f,hotKeys:n});const d=g(()=>o.value&&!!p.value.length),C=()=>{d.value&&M()},N=()=>{d.value&&A()},S=r=>{if(!d.value)return;const m=p.value[r];m&&c.push(m.link).then(()=>{l.value="",v.value=0})};return()=>i("form",{class:"search-box",role:"search"},[i("input",{ref:f,type:"search",placeholder:y.value.placeholder,autocomplete:"off",spellcheck:!1,value:l.value,onFocus:()=>{o.value=!0},onBlur:()=>{o.value=!1},onInput:r=>{l.value=r.target.value},onKeydown:r=>{switch(r.key){case"ArrowUp":{C();break}case"ArrowDown":{N();break}case"Enter":{r.preventDefault(),S(v.value);break}}}}),d.value&&i("ul",{class:"suggestions",onMouseleave:()=>{v.value=-1}},p.value.map(({link:r,title:m,header:b},x)=>i("li",{class:["suggestion",{focus:v.value===x}],onMouseenter:()=>{v.value=x},onMousedown:()=>{S(x)}},i("a",{href:r,onClick:D=>{D.preventDefault()}},[i("span",{class:"page-title"},m),b&&i("span",{class:"page-header"},`> ${b}`)]))))])}});export{O as SearchBox,w as isFocusingTextControl,I as isKeyMatched,k as isQueryMatched,E as searchIndex,K as useHotKeys,L as useSearchIndex,R as useSearchSuggestions,$ as useSuggestionsFocus};
//# sourceMappingURL=index.js.map
